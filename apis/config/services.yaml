services:
  _defaults:
    autowire: true
    autoconfigure: true

  # Controllers precisam ser públicos para serem instanciados pelo roteador
  App\Controller\:
    resource: '../src/Controller/'
    public: true
    tags: ['controller.service_arguments']

  # Demais serviços da aplicação
  App\:
    resource: '../src/'
    exclude:
      - '../src/Kernel.php'
      - '../src/Controller/'

  App\Service\JwtTokenProvider:
    arguments:
      $appSecret: '%env(APP_SECRET)%'

  # Rate Limiter para Login - usa sistema de arquivos para persistir entre requests
  App\Service\LoginRateLimiter:
    public: true
    arguments:
      $projectDir: '%kernel.project_dir%'

  # Auditoria automática via Doctrine Events (EVENT LISTENER)
  App\EventSubscriber\DoctrineAuditSubscriber:
    tags:
      - { name: doctrine.event_listener, event: onFlush, connection: default }

  # CORS Headers
  App\EventSubscriber\CorsSubscriber:
    tags:
      - { name: kernel.event_subscriber }
